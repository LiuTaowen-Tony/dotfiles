#! /bin/bash

CHECK_OUTPUT="$HOME/.check_update_output.txt"
touch $CHECK_OUTPUT

cat $CHECK_OUTPUT
cat /dev/null > $CHECK_OUTPUT

update () {
  cd "$HOME/dotfiles"
  PULL_MESSAGE=$(git pull)
  if [[ $PULL_MESSAGE = *Already* ]] ; then 
    echo "dotfiles is updated ✅"
  elif [[ $PULL_MESSAGE = *conflict* ]] ; then
    echo "$TARGET_DIR merge conflict detected. Please merge the changes manually. ❌"
    git merge --abort > /dev/null
  else
    echo "dotfiles has update ❗️"
    git st -s
  fi
}

(update >> $CHECK_OUTPUT ; deploy_dotfiles >> $CHECK_OUTPUT) &
